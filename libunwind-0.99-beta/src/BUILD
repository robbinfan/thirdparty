gen_rule(
    name = "gen_config",
    cmd="cd thirdparty/libunwind-0.99-beta;./configure;cd -",
    outs=['config.h']
)

cc_library(
    name = 'unwind',
    srcs = [
        'os-linux.c',
        'elf64.c',
        'dwarf/global.c',
        'dwarf/Lexpr.c',
        'dwarf/Lfde.c',
        'dwarf/Lparser.c',
        'dwarf/Lpe.c',
        'dwarf/Lstep.c',
        'dwarf/Lfind_proc_info-lsb.c',
        'x86_64/is_fpreg.c',
        'x86_64/regname.c',
        'x86_64/setcontext.S',
        'x86_64/Lcreate_addr_space.c',
        'x86_64/Lget_save_loc.c',
        'x86_64/Lglobal.c',
        'x86_64/Linit.c',
        'x86_64/Linit_local.c',
        'x86_64/Linit_remote.c',
        'x86_64/Lis_signal_frame.c',
        'x86_64/Lget_proc_info.c',
        'x86_64/Lregs.c',
        'x86_64/Lresume.c',
        'x86_64/Lstep.c',
        'x86_64/getcontext.S',
        'mi/init.c',
        'mi/flush_cache.c',
        'mi/mempool.c',
        'mi/strerror.c',
        'mi/backtrace.c',
        'mi/dyn-cancel.c',
        'mi/dyn-info-list.c',
        'mi/dyn-register.c',
        'mi/Ldyn-extract.c',
        'mi/Lfind_dynamic_proc_info.c',
        'mi/Lget_accessors.c',
        'mi/Lget_proc_info_by_ip.c',
        'mi/Lget_proc_name.c',
        'mi/Lput_dynamic_unwind_info.c',
        'mi/Ldestroy_addr_space.c',
        'mi/Lget_reg.c',
        'mi/Lset_reg.c',
        'mi/Lget_fpreg.c',
        'mi/Lset_fpreg.c',
        'mi/Lset_caching_policy.c',

    ],
    deps = [':gen_config'],
    incs = ['.', '../include', '../include/tdep-x86_64'],
    defs = ['HAVE_CONFIG_H', '_GNU_SOURCE'],
    warning = 'no'
)
